function build_custom_field_group(e,a,t,i,l){function n(e){var a=r.clone();a.find("input, textarea, select").not(".code_style").each(function(){$(this).attr("name",$(this).attr("name").replace(l,l+"["+c+"]"))}),o.append(a),d.trigger("update_custom_group_number");for(var i in t)cama_build_custom_field(a.find(".content-field-"+t[i].id),t[i],e[i]);return 0==c&&a.children(".header-field-grouped").find(".del").remove(),c++,!1}0==e.length&&(e=[{}]);var d=$("#custom_field_group_"+a),o=d.find(" > .panel-body"),r=o.children(".custom_sortable_grouped").clone().removeClass("hidden"),c=0;o.children(".custom_sortable_grouped").remove(),i?(o.sortable({handle:".move.fa-arrows",items:" > .custom_sortable_grouped",update:function(){d.trigger("update_custom_group_number")},start:function(e,a){$(a.item).find(".mce-panel").each(function(){tinymce.execCommand("mceRemoveEditor",!1,$(this).next().addClass("cama_restore_editor").attr("id"))})},stop:function(e,a){$(a.item).find(".cama_restore_editor").each(function(){tinymce.execCommand("mceAddEditor",!0,$(this).attr("id"))})}}),d.find(".btn.duplicate_cutom_group").click(n),o.on("click",".header-field-grouped .del",function(){return confirm(I18n("msg.delete_item"))&&$(this).closest(".custom_sortable_grouped").fadeOut("slow",function(){$(this).remove(),d.trigger("update_custom_group_number")}),!1}),o.on("click",".header-field-grouped .toggleable",function(){return $(this).hasClass("fa-angle-down")?$(this).removeClass("fa-angle-down").addClass("fa-angle-up").closest(".header-field-grouped").next().slideUp():$(this).removeClass("fa-angle-up").addClass("fa-angle-down").closest(".header-field-grouped").next().slideDown(),!1}),d.bind("update_custom_group_number",function(){$(this).find(".custom_sortable_grouped").each(function(e){$(this).find("input.cama_custom_group_number").val(e)})}),$.each(e,function(){n(this)})):n(e[0])}function cama_build_custom_field(panel,field_data,values){function add_field(value){var field=$field.clone(!0);field_data.multiple&&(field.prepend(field_actions),0==field_counter&&field.children(".actions").find(".fa-times").remove()),$field.find(".group-input-fields-content").hasClass("cama_skip_cf_rename_multiple")||field.find("input, textarea, select").each(function(){$(this).attr("name",$(this).attr("name").replace("[]","["+field_counter+"]"))}),field_data.disabled&&(field.find("input, textarea, select").prop("readonly",!0).filter("select").click(function(){return!1}).focus(function(){$(this).blur()}),field.find(".btn").addClass("disabled").unbind().click(function(){return!1})),"checkbox"==field_data.kind?field.find("input")[0].checked=value:value&&field.find(".input-value").val(value).trigger("change",{field_rendered:!0}),$sortable.append(field),callback&&eval(callback+"(field, value);"),field_counter++}values=values||[];var field_counter=0,$field=panel.clone().wrap("li");panel.html("<div class='cama_w_custom_fields'></div>"+(field_data.multiple?"<div class='field_multiple_btn'> <a href='#' class='btn btn-warning btn-xs'> <i class='fa fa-plus'></i> "+panel.attr("data-add_field_title")+"</a></div>":""));var field_actions='<div class="actions"><i style="cursor: move" class="fa fa-arrows"></i> <i style="cursor: pointer" class="fa fa-times text-danger"></i></div>',callback=$field.find(".group-input-fields-content").attr("data-callback-render"),$sortable=panel.children(".cama_w_custom_fields");"checkbox"!=field_data.kind&&values.length<=0&&(values=[field_data.default_value]),"checkboxes"!=field_data.kind?(!field_data.multiple&&values.length>1&&(values=[values[0]]),"checkbox"==field_data.kind?add_field(values[0]):$.each(values,function(e,a){add_field(a)})):add_field(values),field_data.multiple&&(panel.find(".field_multiple_btn .btn").click(function(){return add_field(field_data.default_value),!1}),panel.delegate(".actions .fa-times","click",function(){return confirm(I18n("msg.delete_item"))&&$(this).closest(".editor-custom-fields").remove(),!1}),$sortable.sortable({handle:".fa-arrows",items:" > .editor-custom-fields",start:function(e,a){$(a.item).find(".mce-panel").each(function(){tinymce.execCommand("mceRemoveEditor",!1,$(this).next().addClass("cama_restore_editor").attr("id"))})},stop:function(e,a){$(a.item).find(".cama_restore_editor").each(function(){tinymce.execCommand("mceAddEditor",!0,$(this).attr("id"))})}}))}function custom_field_colorpicker(e){e&&e.find(".my-colorpicker").colorpicker()}function custom_field_colorpicker_val(e,a){e&&e.find(".my-colorpicker").attr("data-color",a).colorpicker()}function custom_field_checkbox_val(e,a){"t"==a&&(a=1),e&&e.find('input[value="'+a+'"]').prop("checked",!0)}function custom_field_checkboxs_val(e,a){if(e){var t=a.map(function(e){return"input[value='"+e+"']"}).join(",");e.find(t).prop("checked",!0)}}function custom_field_date(e){if(e){var a=e.find(".date-input-box");a.hasClass("is_datetimepicker")?a.datetimepicker({format:"YYYY-MM-DD HH:mm"}):a.datepicker()}}function custom_field_editor(e){if(e){var a="t_"+Math.floor(1e5*Math.random()+1)+"_area",t=e.find("textarea").attr("id",a);if(t.hasClass("is_translate")){t.addClass("translatable").Translatable(ADMIN_TRANSLATIONS);var i=t.data("translation_inputs");if(i){for(var l in i)tinymce.init(cama_get_tinymce_settings({selector:"#"+i[l].attr("id"),height:120}));return}}tinymce.init(cama_get_tinymce_settings({selector:"#"+a,height:120}))}}function custom_field_field_attrs_val(e,a){if(e){a=a||"{}";var t="object"==typeof a?a:$.parseJSON(a);e.find(".input-attr").val(t.attr),e.find(".input-value").val(t.value),e.find(".input-attr, .input-value").filter(".is_translate").addClass("translatable").Translatable(ADMIN_TRANSLATIONS)}}function custom_field_radio_val(e,a){e&&(e.find("input").prop("checked",!1),e.find("input[value='"+a+"']").prop("checked",!0))}function custom_field_text_area(e){e&&e.find("textarea").hasClass("is_translate")&&e.find("textarea").addClass("translatable").Translatable(ADMIN_TRANSLATIONS)}function custom_field_text_box(e){e&&e.find("input").hasClass("is_translate")&&e.find("input").addClass("translatable").Translatable(ADMIN_TRANSLATIONS)}function load_upload_audio_field(e){var a=$(e).prev();$.fn.upload_filemanager({formats:"audio",selected:function(e){a.val(e.url)}})}function load_upload_file_field(e){var a=$(e).prev();$.fn.upload_filemanager({formats:a.data("formats")?a.data("formats"):"",selected:function(e){a.val(e.url)}})}function load_upload_private_file_field(e){var a=$(e).prev();$.fn.upload_filemanager({formats:a.data("formats")?a.data("formats"):"",selected:function(e){a.val(e.url.split("?file=")[1].replace(/%2/g,"/"))},"private":!0})}function load_upload_image_field(e){$.fn.upload_filemanager({formats:"image",dimension:e.attr("data-dimension")||"",versions:e.attr("data-versions")||"",thumb_size:e.attr("data-thumb_size")||"",selected:function(a){e.val(a.url).trigger("change")}})}function cama_custom_field_image_changed(e){e.val()?e.closest(".input-group").append('<span class="input-group-addon custom_field_image_preview"><a href="'+e.val()+'" target="_blank"><img src="'+e.val()+'" style="width: 50px; height: 20px;"></a></span>'):e.closest(".input-group").find(".custom_field_image_preview").remove()}function load_upload_video_field(e){var a=$(e).prev();$.fn.upload_filemanager({formats:"video",selected:function(e){a.val(e.url)}})}